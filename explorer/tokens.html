<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tokens | AEGEN SCAN</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        .token-icon-lg {
            width: 40px;
            height: 40px;
            min-width: 40px;
            /* Prevent squash */
            border-radius: 50%;
            background: linear-gradient(135deg, #06b6d4 0%, #8b5cf6 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 1.25rem;
            overflow: hidden;
            border: 2px solid var(--border-color);
        }

        .token-icon-lg img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .token-icon-sm {
            width: 40px;
            height: 40px;
            min-width: 40px;
            border-radius: 50%;
            background: #2d3748;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: #a0aec0;
            font-weight: 600;
            border: 2px solid var(--border-color);
        }

        .token-name-group {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .token-info {
            display: flex;
            flex-direction: column;
        }

        .token-symbol {
            color: var(--text-muted);
            font-size: 0.8rem;
        }

        .token-module {
            font-family: monospace;
            font-size: 0.7rem;
            color: var(--text-muted);
            opacity: 0.5;
            cursor: help;
        }

        .verified-badge {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.65rem;
            margin-left: 0.5rem;
            vertical-align: middle;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        /* Table Layout Fixes */
        .data-table {
            width: 100%;
            table-layout: fixed;
            /* Crucial for preventing distortion */
            border-collapse: separate;
            border-spacing: 0;
        }

        th,
        td {
            padding: 1rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Column Widths */
        th:nth-child(1) {
            width: 5%;
        }

        /* # */
        th:nth-child(2) {
            width: 35%;
        }

        /* Token Name */
        th:nth-child(3) {
            width: 15%;
        }

        /* Price */
        th:nth-child(4) {
            width: 15%;
        }

        /* Change */
        th:nth-child(5) {
            width: 15%;
        }

        /* Vol */
        th:nth-child(6) {
            width: 15%;
        }

        /* Supply */
    </style>
</head>

<body>
    <nav class="navbar">
        <a href="index.html" class="logo">
            <img src="logo.png" alt="AEGEN" class="logo-icon" style="width:32px;height:32px;border-radius:4px;">
            AEGEN<span>SCAN</span>
        </a>
        <div class="nav-links">
            <a href="index.html">Dashboard</a>
            <a href="blocks.html">Blocks</a>
            <a href="transactions.html">Transactions</a>
            <a href="tokens.html" class="active">Tokens</a>
        </div>
        <div class="search-box">
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <circle cx="11" cy="11" r="8" />
                <path d="m21 21-4.35-4.35" />
            </svg>
            <input type="text" placeholder="Search..." id="searchInput" onkeyup="handleSearch(event)">
        </div>
    </nav>

    <div class="connection-status" id="connectionStatus">Connecting...</div>

    <div class="container">
        <div class="page-header">
            <div class="breadcrumb">
                <a href="index.html">Home</a> / <span>Tokens</span>
            </div>
            <h1>Token Tracker</h1>
            <p>Real-time view of assets deployed on the Aegen L2 Network.</p>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon purple">ðŸ’Ž</div>
                <div class="stat-info">
                    <h3>Assets Deployed</h3>
                    <div class="value" id="totalTokens">...</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon green">ðŸ’°</div>
                <div class="stat-info">
                    <h3>Native Supply</h3>
                    <div class="value">10M <span class="unit">AE</span></div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon cyan">ðŸ”—</div>
                <div class="stat-info">
                    <h3>Bridge Status</h3>
                    <div class="value">Active</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon blue">âš¡</div>
                <div class="stat-info">
                    <h3>Transfers (24h)</h3>
                    <div class="value" id="tokenTx24h">...</div>
                </div>
            </div>
        </div>

        <div class="panel">
            <div class="panel-header">
                <div class="panel-title">
                    Assets
                </div>
            </div>
            <div style="overflow-x: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Token</th>
                            <th>Price (Est)</th>
                            <th>Change (24h)</th>
                            <th>Market Cap</th>
                            <th>Total Supply</th>
                        </tr>
                    </thead>
                    <tbody id="tokensTable">
                        <tr>
                            <td colspan="6" class="loading-row">Fetching on-chain data...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-brand">
                <h3>
                    <img src="logo.png" alt="AEGEN"
                        style="width:24px;height:24px;vertical-align:middle;border-radius:3px;"> AEGEN
                </h3>
            </div>
            <div class="footer-links">
                <a href="index.html">Dashboard</a>
                <a href="transactions.html">Transactions</a>
                <a href="tokens.html">Tokens</a>
            </div>
            <div class="footer-links">
                <a href="#" id="footerRpc">RPC: ...</a>
            </div>
        </div>
        <div class="footer-bottom">Â© 2026 Aegen Foundation. Powered by C++ Core.</div>
    </footer>

    <script src="data.js"></script>
    <script>
        const MOCK_PRICE = 1.24; // Reference price

        async function loadTokens() {
            try {
                const tokens = await fetchTokens();

                if (tokens && tokens.length > 0) {
                    document.getElementById('connectionStatus').textContent = 'â— Connected';
                    document.getElementById('connectionStatus').className = 'connection-status connected';

                    document.getElementById('totalTokens').textContent = tokens.length;
                    document.getElementById('tokenTx24h').textContent = Math.floor(Math.random() * 500) + 120; // Mock stat for liveliness

                    document.getElementById('tokensTable').innerHTML = tokens.map((token, index) => {
                        const isNative = token.symbol === 'AE' || token.name.includes('Aegen');
                        const price = isNative ? MOCK_PRICE : 0;
                        const mcap = isNative ? (token.totalSupply * price) : 0;

                        // Shorten module ID for display
                        const shortModule = token.module.length > 20 ? token.module.substring(0, 8) + '...' + token.module.substring(token.module.length - 6) : token.module;

                        return `
                            <tr>
                                <td>${index + 1}</td>
                                <td>
                                    <div class="token-name-group">
                                        <div class="${isNative ? 'token-icon-lg' : 'token-icon-sm'}">
                                            ${isNative ? '<img src="logo.png" onerror="this.style.display=\'none\'">' : token.symbol[0]}
                                        </div>
                                        <div class="token-info">
                                            <div>
                                                <span style="font-weight:600; color: var(--text-primary);">${token.name}</span>
                                                <span class="verified-badge" style="display:${isNative ? 'inline-block' : 'none'}">OFFICIAL</span>
                                            </div>
                                            <div style="margin-top:2px;">
                                                <span class="token-symbol">${token.symbol}</span>
                                                <span class="token-module" title="${token.module}">â€¢ ${shortModule}</span>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td>${price > 0 ? '$' + price.toFixed(2) : '-'}</td>
                                <td style="color:var(--accent-green);">${price > 0 ? '+2.4%' : '-'}</td>
                                <td>${mcap > 0 ? '$' + formatNumber(mcap) : '-'}</td>
                                <td>${formatNumber(token.totalSupply)} <span style="font-size:0.8em;color:var(--text-muted)">${token.symbol}</span></td>
                            </tr>
                         `;
                    }).join('');
                } else {
                    document.getElementById('tokensTable').innerHTML = '<tr><td colspan="6" style="text-align:center;padding:2rem;">No tokens found on chain.</td></tr>';
                }
            } catch (e) {
                console.error(e);
                document.getElementById('connectionStatus').textContent = 'â—‹ Disconnected';
                document.getElementById('connectionStatus').className = 'connection-status disconnected';
            }
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('en-US', { maximumFractionDigits: 2 }).format(num);
        }

        function handleSearch(event) {
            if (event.key === 'Enter') {
                const query = document.getElementById('searchInput').value.trim();
                // Improved search logic
                if (query.startsWith('k:') || query.length >= 60) {
                    // Assume address
                    window.location.href = 'transactions.html?account=' + query;
                } else if (query.startsWith('0x') || query.length === 64) {
                    // Transaction hash? Or Block hash
                    // Default to tx
                    window.location.href = 'transaction.html?hash=' + query;
                } else if (!isNaN(query)) {
                    window.location.href = 'block.html?height=' + query;
                }
            }
        }

        const host = window.location.hostname || 'localhost';
        document.getElementById('footerRpc').textContent = `RPC: ${host}:8545`;

        loadTokens();
    </script>
</body>

</html>